<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Comments">
	<insert id="insert" parameterType="C">
		INSERT INTO comments (cmt_no, isbn, cmt_mbti, cmt_nickname, cmt_content,  cmt_date, cmt_id) values(cmt_no.nextval, #{isbn}, #{cmt_mbti}, #{cmt_nickname}, #{cmt_content},  sysdate, #{cmt_id})
	</insert>
	
	<select id="member_info" parameterType="String" resultType="member">
		select * from member where m_id=#{id}
	</select>
	
	
	<select id="comments_count" parameterType="String" resultType="int">
		select count(*) from comments where isbn =#{isbn}
	</select>
	
	<select id="comments_list" parameterType="map" resultType="C">
		select * 
		from ( select rownum rnum, cmt_no, cmt_nickname, cmt_content, cmt_date, cmt_mbti, cmt_id
			   from (
					  select cmt_no, cmt_nickname, cmt_content, cmt_date, cmt_mbti, cmt_id
					  from comments where isbn = #{isbn}			   
			  		   order by cmt_date desc
					 )		   
		   )
		   where rnum &gt;=#{start} and rnum &lt;= #{end}
	</select>
	
	<delete id="comments_delete" parameterType="String">
		delete from comments where cmt_no=#{cmt_no}
	</delete>
	
	<update id="comments_update" parameterType="C"> 
		update comments set CMT_CONTENT = #{cmt_content} where CMT_NO= #{cmt_no}
	</update>
	
	<select id="listcount" resultType="int" parameterType="String">
	select count(*) from comments where cmt_id = #{id}
	</select>
	
	<select id="mycomment_list" parameterType="map" resultMap="commentMap">
		select * from comments left join book on book.isbn=comments.isbn where cmt_id=#{id}
	</select>
	
	<resultMap type="com.identity.project.domain.Comments" id="commentMap">
		<id column="cmt_no"  property="cmt_no"/>
		<result property="isbn" column="isbn" />
		<result property="cmt_id" column="cmt_id" />
		<result property="cmt_mbti" column="cmt_mbti"  />
		<result property="cmt_content" column="cmt_content" />
		<result property="cmt_date" column="cmt_date"  />
		<result property="cmt_like" column="cmt_like"  />
		
		<association javaType="com.identity.project.domain.Book" property="book">
         <id property="isbn" column="isbn"/>
         <result property="b_title" column="b_title"/>
         <result property="b_thumbnail" column="b_thumbnail"/>
         <result property="b_content" column="b_content"/>
         <result property="b_authors" column="b_authors"/>
         <result property="mbti" column="mbti"/>
         <result property="b_publisher" column="b_publisher"/>
         <result property="b_saleprice" column="b_saleprice"/>
         <result property="b_datetime" column="b_datetime"/>
      </association>
      
	</resultMap>
</mapper>