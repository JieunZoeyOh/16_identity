<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Comments">
	<insert id="insert" parameterType="C">
		INSERT INTO comments (cmt_no, isbn, cmt_mbti, cmt_nickname, cmt_content,  cmt_date, cmt_id) values(cmt_no.nextval, #{isbn}, #{cmt_mbti}, #{cmt_nickname}, #{cmt_content},  sysdate, #{cmt_id})
	</insert>
	
	<select id="member_info" parameterType="String" resultType="member">
		select * from member where m_id=#{id}
	</select>
	
	
	<select id="comments_count" parameterType="String" resultType="int">
		select count(*) from comments where isbn =#{isbn}
	</select>
	
	<select id="comments_list" parameterType="map" resultType="C">
		select * 
		from ( select rownum rnum, cmt_no, cmt_nickname, cmt_content, cmt_date, cmt_mbti, cmt_id
			   from (
					  select cmt_no, cmt_nickname, cmt_content, cmt_date, cmt_mbti, cmt_id
					  from comments where isbn = #{isbn}			   
			  		   order by cmt_date desc
					 )		   
		   )
		   where rnum &gt;=#{start} and rnum &lt;= #{end}
	</select>
	
	<delete id="comments_delete" parameterType="String">
		delete from comments where cmt_no=#{cmt_no}
	</delete>
	
	<update id="comments_update" parameterType="C"> 
		update comments set CMT_CONTENT = #{cmt_content} where CMT_NO= #{cmt_no}
	</update>
	
	<select id="comments_info_id" parameterType="int" resultType="String" >
		select cmt_id from comments where cmt_no=#{cmt_no}
	</select>
	
	<select id="warn_check" parameterType="warn" resultType="warn">
		select * from warn where m_id=#{m_id} and cmt_no=#{cmt_no}
	</select>
	
	<insert id="insert_warn"  parameterType="warn">
		insert into warn values(warn_seq.nextval,#{m_id},#{cmt_no},#{w_reason},sysdate, 1)
	</insert>
	
	<update id="update_warn" parameterType="warn">
		update warn set w_count=#{w_count}, w_reason=#{w_reason}, w_date=sysdate where cmt_no=#{cmt_no} and m_id=#{m_id}
	</update>
	
	<select id="wc_check" parameterType="warn_check" resultType="warn_check" >
		select * from warn_check where m_id=#{m_id} and cmt_no=#{cmt_no}
	</select>
	
	<insert id="wc_insert" parameterType="warn_check">
		insert into warn_check values(wc_seq.nextval, #{m_id}, #{cmt_no}, sysdate)
	</insert>
	<select id="getCommentCount" resultType="int">
		select count(*) from comments
	</select>
</mapper>